# Social-test API

Этот проект был написан как учебный. использовался Nest.js, TypeOrm и Postgresql.


<details><summary>Техническое задание</summary>
<span>Необходимо создать приложение - аналог ленты в социальной сети, которое будет работать со специально созданным API. Описание API находится далее по тексту.<br><br>Общий вид такого приложения:<br><br><br><br>На данной странице должны отображаться ваши посты и посты других пользователей, на которых вы подписаны, в порядке убывания даты (то есть, самые недавние посты должны располагаться сверху)<br><br>Кнопка "Редактировать" открывает окно редактирования профиля, в него вы вводите имя и фамилию.<br><br><br>При нажатии на "Save" информация на странице должна обновиться.<br>Нажатие на кнопку "Follow user" открывает окно ввода e-mail, на которого вы хотите подписаться.<br><br>После того, как вы подписались на пользователя, его сообщения должны также отображаться, одновременно с вашими.<br><br>Вы можете меняться адресами e-mail с вашими коллегами, и подписываться друг на друга, или создать несколько пользователей.Описание API<br><br>Базовый URL:&nbsp;<a target="_blank" href="http://146.185.154.90:8000/blog/">http://146.185.154.90:8000/blog/</a>{e-mail}<br><br>Для того, чтобы совершать запросы на API вам потребуется свой адрес электронной почты. Он будет служить вашим уникальным идентификатором. Для этого вы добавляете к базовому URL свой e-mail, например, таким образом:<br><br><a target="_blank" href="http://146.185.154.90:8000/blog/john.doe@gmail.com/">http://146.185.154.90:8000/blog/john.doe@gmail.com/</a><br><br>Остальные адреса, указанные ниже будут&nbsp;добавляться к этому URL.Профиль<br><br>Чтобы начать работу, вам нужно отправить GET-запрос на адрес:<br><ul><li>GET /profile</li></ul>При этом в базе данных создастся ваш профиль, со стандартным именем John Doe.<br><br>Только после этого запроса можно будет делать запросы на все остальные API. Если сделать запрос на этот адрес в следующий раз, будет приходить информация о вашем профиле. Если вы измените имя и фамилию (см. дальше), будет приходить уже ваша новая (обновленная) информация.<br><br>Чтобы изменить свои данные:<br><ul><li>POST /profile</li><li>Отправляете данные:</li><li>firstName: текст, не должен быть пустым</li><li>lastName: текст, не должен быть пустым</li></ul>Лента<br><br>Чтобы запросить "ленту" (последние 20 постов):<br><ul><li>GET /posts</li></ul>Чтобы запросить "ленту" с определенной даты:<ul><li>GET /posts?datetime={datetime}</li><li>где {datetime} - дата в формате ISO-строки (которую вы получаете от API)</li></ul>Чтобы отправить новый пост:<br><ul><li>POST /posts</li><li>Отправляете данные:</li><li>message: текст, не должен быть пустым</li></ul>Подписка<br><br>Чтобы подписаться на нового пользователя:<br><ul><li>POST /subscribe</li><li>Отправляете данные:</li><li>email: текст, должен присутствовать в базе</li></ul>Также вы можете отправлять такой POST-запрос без данных, чтобы очистить все подписки (например, для тестирования):<br><ul><li>POST /subscribe/delete</li></ul>Чтобы посмотреть ваших подписчиков (например, чтобы проверить, добавился ли пользователь):<br><ul><li>GET /subscribe</li></ul>Вам будет возвращен список пользователей, на которые вы подписаны, в виде массива.Указания<ul><li>Приблизительный алгоритм работы приложения:</li><li>Основная программа:</li><li>Запросить ваш профиль. Сохранить полученные данные в переменную.</li><li>Отобразить ваше имя на странице</li><li>Запросить последние посты.</li><li>Добавить последние посты в список</li><li>Создать интервал, который будет запрашивать новые посты.</li><li>При клике на кнопку "Редактировать профиль" отобразить окно (попап) с вводом данных (имени и фамилии).</li><li>При клике на кнопку "Save" отправить данные на сервер</li><li>При успешном ответе от сервера обновить данные в переменной и отображаемые данные</li><li>Закрыть окно</li><li>При вводе текста в поле создания нового сообщения и клике на "Send"</li><li>Отправить данные нового сообщения на сервер</li><li>При клике на кнопку "Добавить подписчика" отобразить окно (попап) с вводом e-mail</li><li>При клике на кнопку "Add" отправить данные на сервер</li><li>При успешном ответе от сервера закрыть окно</li><li>Необходимо пользоваться Promise-ами везде, где можно. Необходимо пользоваться конструкцией async/await везде, где применимо.</li><li>Не делайте слишком быстрый интервал! Вы можете все одновременными запросами перегрузить сервер. Установите его на как минимум 2 секунды.</li><li>Можно пользоваться любыми библиотеками, плагинами, и т.п. какие вы найдете (например, для popup-окон).</li><li>Можете оформить ваше приложение с помощью Bootstrap (по желанию).</li><li>Для тестирования запросов можно пользоваться Postman или аналогичными инструментами.</li></ul></span>
</details>


**Запуск проекта**

```
git clone https://github.com/DenisLokhtin/social_test.git

cd social_test/

npm i

npm run build

npm run start:dev
```

- После успешной сборки и запуска, приложение будет доступно на localhost 3003 порту.

***

**Эндпоинты:**

в приложении есть несколько эндпоинтов:

```
GET /blog/:email/profile
POST /blog/:email/profile

GET /blog/:email/posts
POST /blog/:email/posts

GET /blog/:email/subscribe
DELETE /blog/:email/subscribe
POST /blog/:email/subscribe

```

***

- **GET /blog/:email/profile**

Возвращает объект пользователя:

(Также при первом запросе создаёт пользователя)
```
{
    "id": 1,
    "first_name": "john",
    "last_name": "doe",
    "email": "john.doe@gmail.ru"
}
```

***

- **GET /blog/:email/posts**

Возвращает список объектов 20 последних постов пользователя и его подписок:

```
[
    {
        "id": 1,
        "createDateTime": "2022-11-25T07:56:21.240Z",
        "description": "post",
        "profileId": 1
    },
    {
        "id": 1,
        "createDateTime": "2022-11-25T07:56:20.048Z",
        "description": "post",
        "profileId": 1
    },
]
```

***

- **GET /blog/:email/subscribe**

Возвращает список объектов с id пользователя и id его подписки.

```
[
    {
        "id": 1,
        "profileId": 1,
        "subscriptionId": 2
    },
    {
        "id": 2,
        "profileId": 1,
        "subscriptionId": 3
    }
]
```

***

**Также все Get /posts может принимать один query параметр:**

- datetime=date (Дата в формате ISO).

**Пример использования:**

```
http://localhost:3003/blog/john.doe@gmail.ru/posts?datetime=2022-11-25T07:56:21.240Z
```

***

- **POST /blog/:email/profile**

Служит для изменения имени и фамилии юзера

Тело запроса:

```
{
	"first_name": string,
	"last_name": string,
	
}
```

- **POST /blog/:email/posts**

Тело запроса:

```
{
	"message": string,
}
```

- **POST /blog/:email/subscribe**

Тело запроса:

```
{
	"email": string,
}
```

***

- **DELETE /blog/:email/subscribe**

**Очищает подписки пользователя**

***
